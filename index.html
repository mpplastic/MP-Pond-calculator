<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MP Pond calculator</title>

  <style>
    :root{
      --clr-primary:#1F3668;
      --clr-primary-dark:#4166b4;
      --clr-secondary:#2B4A86;
      --clr-bg1:#1F3668;
      --clr-bg2:#FFFFFF;

      --clr-danger:#dc2626;
      --clr-warning:#facc15;
      --clr-card:#ffffff;
      --clr-muted:#6b7280;
      --shadow:0 10px 28px rgba(17,24,39,.10);
      --radius:14px;
    }

    *{box-sizing:border-box;font-family:'Segoe UI', Tahoma, Arial, sans-serif}
    body{
      margin:0;
      color:#111827;
      background:linear-gradient(180deg, var(--clr-bg1) 0%, #E9EEF9 20%, var(--clr-bg2) 100%);
      min-height:100vh;
    }

    h1{ text-align:center; margin:26px 0 18px; font-size:26px; color:#fff; letter-spacing:.2px; }
    .topbar{
      padding:18px 12px 6px;
      background:linear-gradient(135deg, #1F3668 0%, #2B4A86 100%);
      box-shadow:0 6px 18px rgba(0,0,0,.10);
    }

    .tabs{ display:flex; justify-content:center; gap:10px; flex-wrap:wrap; margin:14px 0 0; padding:0 10px 18px; }
    .tab{
      padding:10px 18px;
      cursor:pointer;
      background:#1F3668;
      color:#ffffff;
      border:2px solid #ffffff;
      border-radius:12px;
      font-weight:600;
      transition:.25s;
    }
    .tab:hover{ transform:translateY(-1px); }
    .tab.active{
      background:#ffffff;
      color:#1F3668;
      border:2px solid #ffffff;
    }

    .container{
      max-width:980px; margin:18px auto 40px; padding:24px;
      background:var(--clr-card); border-radius:var(--radius); box-shadow:var(--shadow);
    }

    label{ display:block; margin-bottom:8px; font-weight:800; }
    .radio-group{ display:flex; flex-wrap:wrap; gap:10px; margin-bottom:14px; }

    input[type="number"], input[type="text"], select, textarea{
      width:100%; padding:14px 16px; border:1px solid #e5e7eb; border-radius:12px;
      margin-bottom:16px; font-size:16px; line-height:1.4; min-height:46px; background:#fff;
      transition:border-color .2s ease, box-shadow .2s ease;
    }
    input[type="number"]:focus, input[type="text"]:focus, select:focus, textarea:focus{
      outline:none; border-color:#B9C7EA; box-shadow:0 0 0 4px rgba(101,126,185,.18);
    }

    textarea{ resize:none; background:#F7F9FF; min-height:260px; }

    button{ border:none; border-radius:12px; padding:12px 18px; font-size:15px; font-weight:900; cursor:pointer; transition:.25s; }
    .btn-primary{ background:var(--clr-primary); color:#fff; }
    .btn-primary:hover{ background:var(--clr-primary-dark); }
    .btn-secondary{ background:var(--clr-secondary); color:#fff; }
    .btn-warning{ background:var(--clr-warning); color:#111; }
    .btn-danger{ background:var(--clr-danger); color:#fff; }

    .copy-btn{
      display:inline-flex; align-items:center; gap:8px; padding:10px 16px;
      border-radius:12px; background:var(--clr-secondary); color:#fff; font-weight:900;
    }
    .copy-btn:hover{ filter:brightness(.97); }

    .hidden{ display:none; }
    .hint{color:var(--clr-muted); font-size:13px; margin:8px 0 10px; line-height:1.55; }

    .items-table{ width:100%; border-collapse:collapse; margin-bottom:14px; border:1px solid #e5e7eb; border-radius:12px; overflow:hidden; }
    .items-table thead{ background:var(--clr-primary); color:#fff; }
    .items-table th, .items-table td{ padding:10px; text-align:center; }
    .items-table tbody tr:nth-child(odd){ background:#F6F8FF; }
    .items-table th:first-child, .items-table td:first-child{ min-width: 200px; }
    .items-table input[type="number"], .items-table select{
      color:#111827 !important; -webkit-text-fill-color:#111827;
      background:#fff; width:100%; height:52px; font-size:18px; padding:10px 12px; text-align:center;
    }

    .row{display:grid; grid-template-columns: 1fr 1fr; gap:12px;}
    @media (max-width:600px){
      .container{ padding:14px; }
      .tab{ padding:8px 14px; font-size:14px; }
      button{ font-size:16px; }
      .items-table{ display:block; overflow-x:auto; }
      .row{ grid-template-columns:1fr; }
      input[type="number"], input[type="text"], select, textarea{ font-size:18px; min-height:52px; }
      .items-table input[type="number"], .items-table select{ height:56px; font-size:20px; }
      textarea{ min-height:300px; }
    }

    .commission-box{
      margin-top:12px;
      padding:14px 16px;
      border-radius:12px;
      border:2px solid #1F3668;
      background:#F7F9FF;
      font-weight:900;
      font-size:18px;
      text-align:center;
    }
    #pondForm button,
#mpflowForm button{
  margin-right:10px;
  margin-bottom:10px;
}
.hint{ margin-top:12px; }
.commission-box{
  margin-top:12px;
  margin-bottom:16px;   /* üëà ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ */
  padding:14px 16px;
  border-radius:12px;
  border:2px solid #1F3668;
  background:#F7F9FF;
  font-weight:900;
  font-size:18px;
  text-align:center;
} 
@keyframes borderFlowRed {
  0% { box-shadow: 0 0 0 0 rgba(255,0,0,0.7); }
  50% { box-shadow: 0 0 20px 6px rgba(255,0,0,0.9); }
  100% { box-shadow: 0 0 0 0 rgba(255,0,0,0.7); }
}

@keyframes borderFlowPurple {
  0% { box-shadow: 0 0 0 0 rgba(128,0,255,0.7); }
  50% { box-shadow: 0 0 25px 8px rgba(160,0,255,1); }
  100% { box-shadow: 0 0 0 0 rgba(128,0,255,0.7); }
}

/* class trigger */
.commission-red {
  animation: borderFlowRed 1.5s infinite;
  border-color: red !important;
}

.commission-purple {
  animation: borderFlowPurple 1.5s infinite;
  border-color: #a000ff !important;
} 
  </style>
</head>

<body>
  <div class="topbar">
    <h1>MP Pond calculator</h1>
    <div class="tabs">
      <div class="tab active" data-tab="pond">‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å‡∏õ‡∏π‡∏ö‡πà‡∏≠</div>
      <div class="tab" data-tab="mpflow">MP Flow</div>
    </div>
  </div>

  <!-- POND -->
  <div class="container" id="pondContainer">
    <form id="pondForm">
      <label>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö (‡∏ä‡∏∑‡πà‡∏≠-‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà-‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£) (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
      <textarea id="pondCustInfo" placeholder="‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡πâ‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ß‡πà‡∏≤ ‡∏™‡πà‡∏á..."></textarea>

      <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤:</label>
      <div class="radio-group">
        <label><input type="radio" name="size" value="0.3L" required> LDPE 0.3</label>
        <label><input type="radio" name="size" value="0.5L" required> LDPE 0.5</label>
        <label><input type="radio" name="size" value="0.5H" required> HDPE 0.5</label>
        <label><input type="radio" name="size" value="0.75H" required> HDPE 0.75</label>
        <label><input type="radio" name="size" value="1.0H" required> HDPE 1.0</label>
        <label><input type="radio" name="size" value="all" required> ‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤ (‡πÇ‡∏ä‡∏ß‡πå‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏∏‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å)</label>
      </div>

      <label>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á (‡πÄ‡∏°‡∏ï‡∏£):</label>
      <input type="number" id="pondWidth" step="0.01" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á" required>

      <label>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß (‡πÄ‡∏°‡∏ï‡∏£):</label>
      <input type="number" id="pondLength" step="0.01" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß" required>

      <label>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏∂‡∏Å (‡πÄ‡∏°‡∏ï‡∏£, ‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö):</label>
      <input type="number" id="pondDepth" step="0.01" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏∂‡∏Å (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)">

      <div class="hint">
        ‡∏™‡∏π‡∏ï‡∏£‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏ú‡πâ‡∏≤‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏∂‡∏Å: ‡πÄ‡∏û‡∏¥‡πà‡∏° (‡∏•‡∏∂‡∏Å√ó2 + 2) ‡πÉ‡∏´‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏¢‡∏≤‡∏ß<br>
        ‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏á: ‡∏Ñ‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å (5 ‡∏ö‡∏≤‡∏ó/‡∏Å‡∏Å.) ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ 300 ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 4,000
      </div>

      <label>‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</label>
      <select id="adminSelect">
        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô...</option>
        <option value="‡∏û‡∏µ‡πà‡∏ü‡πâ‡∏≤">‡∏û‡∏µ‡πà‡πÄ‡∏Å‡πã</option>
        <option value="‡∏û‡∏µ‡πà‡πÄ‡∏Å‡πã">‡∏û‡∏µ‡πà‡πÄ‡∏Å‡πã</option>
        <option value="‡∏ö‡∏¥‡πä‡∏á">‡∏ö‡∏¥‡πä‡∏á</option>
        <option value="‡πÄ‡∏õ‡∏¥‡πâ‡∏•">‡πÄ‡∏õ‡∏¥‡πâ‡∏•</option>
        <option value="‡∏≠‡∏¥‡∏á">‡∏≠‡∏¥‡∏á</option>
      </select>

      <button type="submit" class="btn-primary">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</button>
      <button type="button" id="pondReset" class="btn-warning hidden">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÉ‡∏´‡∏°‡πà</button>
    </form>

    <textarea id="pondResult" readonly placeholder="‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà"></textarea>

    <div id="pondCommissionBox" class="commission-box hidden">
      üí∞ ‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏° (5% ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ú‡πâ‡∏≤): <span id="pondCommissionValue">0</span> ‡∏ö‡∏≤‡∏ó
    </div>

    <button id="pondCopy" class="copy-btn hidden">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</button>
  </div>

  <!-- MP FLOW -->
  <div class="container hidden" id="mpflowContainer">
    <form id="mpflowForm">
      <label>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö (‡∏ä‡∏∑‡πà‡∏≠-‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà-‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£) (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
      <textarea id="mpflowCustInfo" placeholder="‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡πâ‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ß‡πà‡∏≤ ‡∏™‡πà‡∏á..."></textarea>

      <h3 style="margin-top:0">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡πâ‡∏≤ (‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1)</h3>
      <table class="items-table" id="clothTable">
        <thead>
          <tr>
            <th>‡πÅ‡∏ö‡∏ö</th>
            <th>‡∏Å‡∏ß‡πâ‡∏≤‡∏á (‡∏°.)</th>
            <th>‡∏¢‡∏≤‡∏ß (‡∏°.)</th>
            <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
            <th>‡∏•‡∏ö</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <button type="button" id="addCloth" class="btn-secondary" style="margin-bottom:8px">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡πâ‡∏≤</button>

      <div class="hint">
        ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÄ‡∏õ‡πá‡∏ô ‚Äú‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏≠‡∏á‚Äù (‡∏Ñ‡∏¥‡∏î 250 ‡∏ö‡∏≤‡∏ó/‡∏ï‡∏£.‡∏°.) ‚Ä¢ ‡∏ñ‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏Å‡∏£‡∏≠‡∏Å‡∏Å‡∏ß‡πâ‡∏≤‡∏á√ó‡∏¢‡∏≤‡∏ß‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡∏Ñ‡∏¥‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡∏≤‡∏°‡∏ä‡∏∏‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
      </div>

      <hr style="opacity:.25; margin:16px 0">

      <label>‡∏ä‡∏∏‡∏î‡πÄ‡∏´‡∏•‡πá‡∏Å‡πÅ‡∏ö‡∏ô (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</label>
      <div class="hint">
        ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∏‡∏î‡πÄ‡∏´‡∏•‡πá‡∏Å‡πÅ‡∏ö‡∏ô‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß/‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏£‡∏ñ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏´‡∏•‡πá‡∏Å‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏Ñ‡∏≤ (‡∏ö‡∏≤‡∏ó/‡∏Ñ‡∏±‡∏ô) ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏π‡∏ì‡∏ï‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏±‡∏ô
      </div>

      <table class="items-table" id="flatbarItemsTable">
        <thead>
          <tr>
            <th>‡∏ä‡∏∏‡∏î‡πÄ‡∏´‡∏•‡πá‡∏Å‡πÅ‡∏ö‡∏ô</th>
            <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏±‡∏ô</th>
            <th>‡∏•‡∏ö</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <button type="button" id="addFlatbarRow" class="btn-secondary" style="margin-bottom:8px">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏´‡∏•‡πá‡∏Å‡πÅ‡∏ö‡∏ô</button>

      <div class="row">
        <div>
          <label>‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</label>
          <select id="mpflowAdminSelect">
            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô...</option>
            <option value="‡∏û‡∏µ‡πà‡∏ü‡πâ‡∏≤">‡∏û‡∏µ‡πà‡πÄ‡∏Å‡πã</option>
            <option value="‡∏û‡∏µ‡πà‡πÄ‡∏Å‡πã">‡∏û‡∏µ‡πà‡πÄ‡∏Å‡πã</option>
            <option value="‡∏ö‡∏¥‡πä‡∏á">‡∏ö‡∏¥‡πä‡∏á</option>
            <option value="‡πÄ‡∏õ‡∏¥‡πâ‡∏•">‡πÄ‡∏õ‡∏¥‡πâ‡∏•</option>
            <option value="‡∏≠‡∏¥‡∏á">‡∏≠‡∏¥‡∏á</option>
          </select>
        </div>
        <div>
          <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</label>
          <input type="text" id="mpflowDate" placeholder="‡πÄ‡∏ä‡πà‡∏ô 20/2/69">
        </div>
      </div>

      <button type="submit" class="btn-primary" style="margin-top:12px">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏£‡∏∏‡∏õ</button>
      <button type="button" id="mpflowReset" class="btn-warning hidden">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÉ‡∏´‡∏°‡πà</button>

      <div id="mpflowCommissionBox" class="commission-box hidden">
        üí∞ ‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏°‡πÄ‡∏ã‡∏• (5% ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ú‡πâ‡∏≤): <span id="mpflowCommissionValue">0</span> ‡∏ö‡∏≤‡∏ó
      </div>
    </form>

    <textarea id="mpflowResult" readonly placeholder="‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà"></textarea>
    <button id="mpflowCopy" class="copy-btn hidden">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</button>
  </div>

  <script>
    // ---------- Tab control ----------
    const tabs = document.querySelectorAll('.tab');
    const sections = { pond: 'pondContainer', mpflow: 'mpflowContainer' };
    tabs.forEach(tab => tab.addEventListener('click', () => {
      tabs.forEach(t => t.classList.remove('active'));
      tab.classList.add('active');
      Object.values(sections).forEach(id => document.getElementById(id).classList.add('hidden'));
      const target = tab.getAttribute('data-tab');
      document.getElementById(sections[target]).classList.remove('hidden');
      window.scrollTo({top:0, behavior:'smooth'});
    }));

    // ---------- Company bank ----------
    const BANK_TEXT =
`‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Å‡∏™‡∏¥‡∏Å‡∏£‡πÑ‡∏ó‡∏¢
‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ: ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏°‡∏ô‡∏π‡∏ò‡∏£‡∏£‡∏°‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å
‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà: 1888-5999-39`;

    // ---------- Pond Shipping rules (by weight) ----------
    const SHIP_MIN = 300, SHIP_MAX = 4000, SHIP_RATE_PER_KG = 5;
    function clampShipping(x){
      if (x <= 0) return 0;
      return Math.min(SHIP_MAX, Math.max(SHIP_MIN, Math.ceil(x)));
    }
    function calcShipPlasticByWeightKg(weightKg){
      return clampShipping(weightKg * SHIP_RATE_PER_KG);
    }

    // ---------- Pond pricing ----------
    function getPondPriceList(){
      return {
        '0.3L': { price:40,  material:'LDPE', thk:0.3 },
        '0.5L': { price:60,  material:'LDPE', thk:0.5 },
        '0.5H': { price:65,  material:'HDPE', thk:0.5 },
        '0.75H':{ price:85,  material:'HDPE', thk:0.75 },
        '1.0H': { price:105, material:'HDPE', thk:1.0 }
      };
    }
    function thkToKgPerSqm(thk){
      const t = Number(thk);
      return (t === 0.3) ? 0.3 :
             (t === 0.5) ? 0.5 :
             (t === 0.75) ? 0.75 :
             (t === 1.0) ? 1.0 : 0;
    }

    // ---------- POND ----------
    const pondForm = document.getElementById('pondForm');
    const pondWidth = document.getElementById('pondWidth');
    const pondLength = document.getElementById('pondLength');
    const pondDepth = document.getElementById('pondDepth');
    const pondCustInfo = document.getElementById('pondCustInfo');
    const pondResult = document.getElementById('pondResult');
    const pondCopy = document.getElementById('pondCopy');
    const pondReset = document.getElementById('pondReset');

    const pondCommissionBox = document.getElementById('pondCommissionBox');
    const pondCommissionValue = document.getElementById('pondCommissionValue');

    pondForm.onsubmit = function(e){
      e.preventDefault();

      const size = document.querySelector('input[name="size"]:checked');
      let w = parseFloat(pondWidth.value), l = parseFloat(pondLength.value), d = parseFloat(pondDepth.value || 0);
      if(!size || w<=0 || l<=0){ alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡πÅ‡∏•‡∏∞‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á'); return; }

      const cust = (pondCustInfo.value || '').trim();
      const hasDepth = d > 0;

      if(hasDepth){ w = w + d*2 + 2; l = l + d*2 + 2; }

      const priceList = getPondPriceList();
      const area = w*l;

      let out = '';
      if(cust) out += `‡∏™‡πà‡∏á\n${cust}\n\n`;

      // reset commission UI each run
      pondCommissionBox.classList.add('hidden');
      pondCommissionValue.textContent = '0';

      if(size.value === 'all'){
        const lines = Object.keys(priceList).map(k=>{
          const p = priceList[k];
          const total = Math.floor(area * p.price);
          const label = `${p.material} ${p.thk}`;
          return `‚Ä¢ ${label} ‡∏°‡∏°. ‚Äì ${total.toLocaleString()} ‡∏ö‡∏≤‡∏ó (${p.price} ‡∏ö‡∏≤‡∏ó/‡∏ï‡∏£.‡∏°.)`;
        }).join('\n');

        out += `‡∏à‡∏≤‡∏Å‡∏Ç‡∏ô‡∏≤‡∏î‡∏ó‡∏µ‡πà‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÅ‡∏à‡πâ‡∏á‡∏°‡∏≤ ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ‡∏Ñ‡πà‡∏∞\n`;
        out += `${lines}\n\n`;
        out += `‡∏™‡∏ô‡πÉ‡∏à‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤‡πÑ‡∏´‡∏ô‡πÅ‡∏à‡πâ‡∏á‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡πà‡∏∞ üòä`;
      } else {
        const sel = priceList[size.value];
        const clothTotal = Math.floor(area * sel.price);         // ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ú‡πâ‡∏≤ (‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤)
        const commission = Math.floor(clothTotal * 0.05);        // ‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏° 5% ‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ú‡πâ‡∏≤
        const kg = area * thkToKgPerSqm(sel.thk);
        const ship = calcShipPlasticByWeightKg(kg);
        const grand = Math.floor(clothTotal + ship);

        out += `üìç ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£:\n`;
        out += `‡∏ú‡πâ‡∏≤‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å ${sel.material} ‡∏´‡∏ô‡∏≤ ${sel.thk} ‡∏°‡∏°. (${sel.price} ‡∏ö‡∏≤‡∏ó/‡∏ï‡∏£.‡∏°.)\n`;
        if(hasDepth){
          out += `‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏∂‡∏Å ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏ú‡πâ‡∏≤‡∏ï‡∏≤‡∏°‡∏™‡∏π‡∏ï‡∏£ (‡∏•‡∏∂‡∏Å√ó2 + 2)\n`;
        }
        out += `‡∏ú‡πâ‡∏≤‡∏Ç‡∏ô‡∏≤‡∏î ${area.toLocaleString()} ‡∏ï‡∏£.‡∏°.\n\n`;

        out += `‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ú‡πâ‡∏≤ ${clothTotal.toLocaleString()} ‡∏ö‡∏≤‡∏ó\n`;
        out += `‡∏Ñ‡πà‡∏≤‡∏à‡∏±‡∏î‡∏™‡πà‡∏á ${ship.toLocaleString()} ‡∏ö‡∏≤‡∏ó\n`;
        out += `‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì ${kg.toFixed(1)} ‡∏Å‡∏Å.\n\n`;

        out += `üìå ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${grand.toLocaleString()} ‡∏ö‡∏≤‡∏ó\n`;
        out += `${BANK_TEXT}\n\n`;
        out += `‡∏£‡∏ö‡∏Å‡∏ß‡∏ô‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ô‡∏∞‡∏Ñ‡∏∞ ‚ú®\n`;
        out += `‡∏´‡∏≤‡∏Å‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ú‡∏•‡∏¥‡∏ï‡πÅ‡∏•‡πâ‡∏ß ‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÑ‡∏î‡πâ‡∏Ñ‡πà‡∏∞\n`;

        const admin = document.getElementById('adminSelect').value;
        if(admin) out += `\n‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô: ${admin}`;

        // show commission box (NOT in summary text)
        pondCommissionValue.textContent = commission.toLocaleString();
        pondCommissionBox.classList.remove('hidden');
        pondCommissionBox.classList.remove('commission-red','commission-purple');

        if(commission > 5000){
          pondCommissionBox.classList.add('commission-purple');
        }else if(commission > 2000){
          pondCommissionBox.classList.add('commission-red');
        }

      }

      pondResult.value = out.trim();
      pondCopy.classList.remove('hidden');
      pondReset.classList.remove('hidden');
    };

    pondCopy.onclick = ()=>{
      pondResult.select();
      document.execCommand('copy');
      alert('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏•‡πâ‡∏ß');
    };
    pondReset.onclick = ()=>{
      pondForm.reset();
      pondResult.value='';
      pondCopy.classList.add('hidden');
      pondReset.classList.add('hidden');
      pondCommissionBox.classList.add('hidden');
      pondCommissionValue.textContent='0';
      pondCommissionBox.classList.remove('commission-red','commission-purple');

    };

    // ---------- MP FLOW ----------
    const mpflowForm = document.getElementById('mpflowForm');
    const mpflowResult = document.getElementById('mpflowResult');
    const mpflowCopy = document.getElementById('mpflowCopy');
    const mpflowReset = document.getElementById('mpflowReset');

    const mpflowCommissionBox = document.getElementById('mpflowCommissionBox');
    const mpflowCommissionValue = document.getElementById('mpflowCommissionValue');

    const clothTableBody = document.querySelector('#clothTable tbody');
    const btnAddCloth = document.getElementById('addCloth');

    // presets
    const CLOTH_PRESETS = {
      '4x3':2400, '4x3.5':2800, '6x3.5':4200, '6x4':4800,
      '7x3.5':4900, '7x4':5600, '8x4':6500, '8x5':8500
    };
    const PRESET_SIZES = {
      '4x3':{w:4,l:3}, '4x3.5':{w:4,l:3.5}, '6x3.5':{w:6,l:3.5}, '6x4':{w:6,l:4},
      '7x3.5':{w:7,l:3.5}, '7x4':{w:7,l:4}, '8x4':{w:8,l:4}, '8x5':{w:8,l:5}
    };

    function makeClothRow(defaultType='custom'){
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>
          <select class="ptype">
            <option value="custom" selected>‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏≠‡∏á</option>
            <option value="4x3">4 ‡∏°. √ó 3 ‡∏°. ‚Äî 2,400</option>
            <option value="4x3.5">4 ‡∏°. √ó 3.5 ‡∏°. ‚Äî 2,800</option>
            <option value="6x3.5">6 ‡∏°. √ó 3.5 ‡∏°. ‚Äî 4,200</option>
            <option value="6x4">6 ‡∏°. √ó 4 ‡∏°. ‚Äî 4,800</option>
            <option value="7x3.5">7 ‡∏°. √ó 3.5 ‡∏°. ‚Äî 4,900</option>
            <option value="7x4">7 ‡∏°. √ó 4 ‡∏°. ‚Äî 5,600</option>
            <option value="8x4">8 ‡∏°. √ó 4 ‡∏°. ‚Äî 6,500</option>
            <option value="8x5">8 ‡∏°. √ó 5 ‡∏°. ‚Äî 8,500</option>
          </select>
        </td>
        <td><input type="number" class="cw" step="0.1" min="0.1" placeholder="‡∏Å‡∏ß‡πâ‡∏≤‡∏á (‡∏°.)"></td>
        <td><input type="number" class="cl" step="0.1" min="0.1" placeholder="‡∏¢‡∏≤‡∏ß (‡∏°.)"></td>
        <td><input type="number" class="cq" value="1" min="1"></td>
        <td><button type="button" class="btn-danger del">‡∏•‡∏ö</button></td>`;

      const sel = tr.querySelector('.ptype');
      const cw = tr.querySelector('.cw');
      const cl = tr.querySelector('.cl');

      function applyType(){
        const val = sel.value;
        if(val !== 'custom'){
          const s = PRESET_SIZES[val];
          cw.value = s.w; cl.value = s.l;
          cw.disabled = true; cl.disabled = true;
        } else {
          cw.disabled = false; cl.disabled = false;
        }
      }

      sel.addEventListener('change', applyType);
      tr.querySelector('.del').addEventListener('click', ()=> tr.remove());
      sel.value = defaultType;
      applyType();
      clothTableBody.appendChild(tr);
    }

    btnAddCloth.addEventListener('click', ()=> makeClothRow('custom'));
    makeClothRow('custom');

    // flatbar presets
    const flatbarItemsBody = document.querySelector('#flatbarItemsTable tbody');
    const addFlatbarRowBtn = document.getElementById('addFlatbarRow');

    const FLATBAR_PRESETS = {
      '7-25': { id:'7-25', length:7, width:2.5, pricePerCar:1850,
        longBars:[{len:3.5,qty:8}], crossBars:[{len:2.4,qty:3}], cornerBars:[{len:0.6,qty:4}] },
      '6-25': { id:'6-25', length:6, width:2.5, pricePerCar:1650,
        longBars:[{len:3.0,qty:8}], crossBars:[{len:2.4,qty:3}], cornerBars:[{len:0.6,qty:4}] },
      '5-25': { id:'5-25', length:5, width:2.5, pricePerCar:1450,
        longBars:[{len:3.0,qty:4},{len:2.0,qty:4}], crossBars:[{len:2.4,qty:3}], cornerBars:[{len:0.6,qty:4}] },
      '4-20': { id:'4-20', length:4, width:2.0, pricePerCar:1200,
        longBars:[{len:2.0,qty:8}], crossBars:[{len:2.0,qty:3}], cornerBars:[{len:0.6,qty:4}] },
    };

    function makeFlatbarRow(defaultId='7-25', qty=1){
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>
          <select class="fpreset">
            <option value="7-25">‡∏£‡∏ñ‡∏¢‡∏≤‡∏ß 7 ‡∏°. ‡∏Å‡∏ß‡πâ‡∏≤‡∏á 2.5 ‡∏°. ‚Äî 1,850 ‡∏ö‡∏≤‡∏ó/‡∏Ñ‡∏±‡∏ô</option>
            <option value="6-25">‡∏£‡∏ñ‡∏¢‡∏≤‡∏ß 6 ‡∏°. ‡∏Å‡∏ß‡πâ‡∏≤‡∏á 2.5 ‡∏°. ‚Äî 1,650 ‡∏ö‡∏≤‡∏ó/‡∏Ñ‡∏±‡∏ô</option>
            <option value="5-25">‡∏£‡∏ñ‡∏¢‡∏≤‡∏ß 5 ‡∏°. ‡∏Å‡∏ß‡πâ‡∏≤‡∏á 2.5 ‡∏°. ‚Äî 1,450 ‡∏ö‡∏≤‡∏ó/‡∏Ñ‡∏±‡∏ô</option>
            <option value="4-20">‡∏£‡∏ñ‡∏¢‡∏≤‡∏ß 4 ‡∏°. ‡∏Å‡∏ß‡πâ‡∏≤‡∏á 2 ‡∏°. ‚Äî 1,200 ‡∏ö‡∏≤‡∏ó/‡∏Ñ‡∏±‡∏ô</option>
          </select>
        </td>
        <td><input type="number" class="fqty" step="1" min="1" value="${qty}"></td>
        <td><button type="button" class="btn-danger fdel">‡∏•‡∏ö</button></td>`;
      tr.querySelector('.fpreset').value = defaultId;
      tr.querySelector('.fdel').onclick = ()=> tr.remove();
      flatbarItemsBody.appendChild(tr);
    }
    addFlatbarRowBtn.addEventListener('click', ()=> makeFlatbarRow());
    makeFlatbarRow();

    function collectFlatbarItems(){
      const rows = [...flatbarItemsBody.querySelectorAll('tr')];
      const items = [];
      for(const tr of rows){
        const id = tr.querySelector('.fpreset')?.value;
        const qty = Math.max(1, parseInt(tr.querySelector('.fqty')?.value || 1, 10));
        const preset = FLATBAR_PRESETS[id];
        if(preset && qty>0) items.push({preset, qty});
      }
      return items;
    }

    function calcFlatbarAggregate(items){
      if(!items.length) return { text:'', totalPrice:0 };
      let blocks=[], totalPrice=0;

      for(const {preset, qty} of items){
        const p = preset;
        const totalThis = p.pricePerCar * qty;
        totalPrice += totalThis;

        const longLines = (p.longBars||[]).map(b=>`‡πÄ‡∏´‡∏•‡πá‡∏Å‡πÅ‡∏ö‡∏ô ${b.len} ‡∏°. √ó ${b.qty*qty} ‡πÄ‡∏™‡πâ‡∏ô`).join('\n');
        const crossLines = (p.crossBars||[]).map(b=>`‡πÄ‡∏´‡∏•‡πá‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ô‡∏ß‡∏Ç‡∏ß‡∏≤‡∏á ${b.len} ‡∏°. √ó ${b.qty*qty} ‡πÄ‡∏™‡πâ‡∏ô`).join('\n');
        const cornerLines = (p.cornerBars||[]).map(b=>`‡πÄ‡∏´‡∏•‡πá‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á‡∏°‡∏∏‡∏° ${b.len} ‡∏°. √ó ${b.qty*qty} ‡πÄ‡∏™‡πâ‡∏ô`).join('\n');

        const unitText = qty>1
          ? `‡∏£‡∏ß‡∏°‡∏¢‡∏≠‡∏î‡∏ä‡∏∏‡∏î‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á ${p.pricePerCar.toLocaleString()} ‡∏ö‡∏≤‡∏ó/‡∏Ñ‡∏±‡∏ô ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ${qty} ‡∏Ñ‡∏±‡∏ô = ${totalThis.toLocaleString()} ‡∏ö‡∏≤‡∏ó`
          : `‡∏£‡∏ß‡∏°‡∏¢‡∏≠‡∏î‡∏ä‡∏∏‡∏î‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á ${p.pricePerCar.toLocaleString()} ‡∏ö‡∏≤‡∏ó/‡∏Ñ‡∏±‡∏ô`;

        blocks.push(
`üì¶ ‡∏ä‡∏∏‡∏î‡πÄ‡∏´‡∏•‡πá‡∏Å‡πÅ‡∏ö‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á MP Flow 2.0
‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡∏£‡∏ñ ${p.length} ‡πÄ‡∏°‡∏ï‡∏£ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á ${p.width} ‡πÄ‡∏°‡∏ï‡∏£

‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö:
${longLines}
${crossLines}
${cornerLines}
‡πÅ‡∏•‡∏∞‡∏™‡∏Å‡∏£‡∏π‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á
${unitText}`
        );
      }
      return { text: blocks.join('\n\n'), totalPrice };
    }

    function collectCloth(){
      const rows = [...clothTableBody.querySelectorAll('tr')];
      let has=false, price=0, lines=[];
      for(const tr of rows){
        const type = tr.querySelector('.ptype').value;
        const cw = parseFloat(tr.querySelector('.cw').value||0);
        const cl = parseFloat(tr.querySelector('.cl').value||0);
        const qty = Math.max(1, parseInt(tr.querySelector('.cq').value||1,10));

        if(type !== 'custom'){
          const u = CLOTH_PRESETS[type]||0;
          const s = PRESET_SIZES[type];
          const sum = u*qty;
          price += sum; has = has || sum>0;
          lines.push(`‡∏ú‡πâ‡∏≤‡∏Ç‡∏ô‡∏≤‡∏î ${s.w}x${s.l}${qty>1?` ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ${qty} ‡∏ú‡∏∑‡∏ô`:''} ‡∏£‡∏≤‡∏Ñ‡∏≤ ${sum.toLocaleString()} ‡∏ö‡∏≤‡∏ó`);
        } else {
          if(!(cw>0 && cl>0)) continue;
          const area = cw*cl;
          const unit = Math.floor(area*250);
          const sum = unit*qty;
          price += sum; has = has || sum>0;
          lines.push(`‡∏ú‡πâ‡∏≤‡∏Ç‡∏ô‡∏≤‡∏î ${cw}x${cl}${qty>1?` ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ${qty} ‡∏ú‡∏∑‡∏ô`:''} ‡∏£‡∏≤‡∏Ñ‡∏≤ ${sum.toLocaleString()} ‡∏ö‡∏≤‡∏ó`);
        }
      }
      return {has, text: lines.join('\n'), price};
    }

    // MP Flow Shipping: width * 100 * qty (sum each row)
    function calcMPFlowShipFromRows(){
      let ship = 0;
      const rows = [...clothTableBody.querySelectorAll('tr')];

      for(const tr of rows){
        const type = tr.querySelector('.ptype').value;
        const qty  = Math.max(1, parseInt(tr.querySelector('.cq').value||1,10));

        let width = 0;
        if(type !== 'custom'){
          width = PRESET_SIZES[type].w;
        } else {
          width = parseFloat(tr.querySelector('.cw').value||0);
        }

        if(width>0) ship += (width * 100 * qty);
      }
      return Math.floor(ship);
    }

    mpflowForm.onsubmit = function(e){
      e.preventDefault();

      const cust = (document.getElementById('mpflowCustInfo').value||'').trim();
      const cloth = collectCloth();
      if(!cloth.has){ alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡πâ‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏≠‡∏Å‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô'); return; }

      const dateText = (document.getElementById('mpflowDate').value||'').trim();
      const admin = (document.getElementById('mpflowAdminSelect').value||'').trim();

      const items = collectFlatbarItems();
      const kit = items.length ? calcFlatbarAggregate(items) : null;

      const ship = calcMPFlowShipFromRows();

      let out = '';
      if(cust) out += `‡∏™‡πà‡∏á\n${cust}\n\n`;

      out += `MP Flow 2.0 HDPE ‡∏´‡∏ô‡∏≤ 2 ‡∏°‡∏¥‡∏•\n`;
      out += `${cloth.text}\n`;

      if(kit && kit.text) out += `\n${kit.text}\n`;

      const subtotal = cloth.price + (kit ? kit.totalPrice : 0);
      const grand = subtotal + ship;

      out += `\n‡∏Ñ‡πà‡∏≤‡∏à‡∏±‡∏î‡∏™‡πà‡∏á ${ship.toLocaleString()} ‡∏ö‡∏≤‡∏ó\n`;
      out += `\nüìå ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${grand.toLocaleString()} ‡∏ö‡∏≤‡∏ó\n`;
      out += `${BANK_TEXT}\n`;

      if(dateText) out += `\n\n‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${dateText}`;
      if(admin) out += `\n‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô: ${admin}`;

      mpflowResult.value = out.trim();
      mpflowCopy.classList.remove('hidden');
      mpflowReset.classList.remove('hidden');

      // commission box (5% of cloth price only)
      const commission = Math.floor(cloth.price * 0.05);
      mpflowCommissionValue.textContent = commission.toLocaleString();
      mpflowCommissionBox.classList.remove('hidden');
      mpflowCommissionBox.classList.remove('commission-red','commission-purple');

      if(commission > 5000){
        mpflowCommissionBox.classList.add('commission-purple');
      }else if(commission > 2000){
        mpflowCommissionBox.classList.add('commission-red');
      }

    };

    mpflowCopy.onclick = ()=>{
      mpflowResult.select();
      document.execCommand('copy');
      alert('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏•‡πâ‡∏ß');
    };

    mpflowReset.onclick = ()=>{
      mpflowForm.reset();
      clothTableBody.innerHTML='';
      makeClothRow('custom');
      flatbarItemsBody.innerHTML='';
      makeFlatbarRow();
      mpflowResult.value='';
      mpflowCopy.classList.add('hidden');
      mpflowReset.classList.add('hidden');
      mpflowCommissionBox.classList.add('hidden');
      mpflowCommissionValue.textContent='0';
      mpflowCommissionBox.classList.remove('commission-red','commission-purple');

    };
  </script>
</body>
</html>

